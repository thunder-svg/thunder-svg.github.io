<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>관리자 업로드 – 천둥 코칭</title>
<style>
:root{--bg:#0b1220;--card:#111b30;--stroke:#213354;--text:#e8eef6;--muted:#a8b4c6;--accent:#ffd84d;--maxw:960px}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,'Noto Sans KR',sans-serif}
.container{max-width:var(--maxw);margin:0 auto;padding:20px}
h1{font-weight:900}
.card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:16px;margin:14px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
input,button{padding:10px 14px;border-radius:10px;border:1px solid var(--stroke);background:#0f1a30;color:var(--text)}
button{cursor:pointer}
.badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#1b2744;border:1px solid #2d3e66;color:#cfe0ff;font-size:12px;margin-left:8px}
.progress{height:8px;border-radius:8px;background:#0f1a30;border:1px solid #20324e;overflow:hidden}
.progress>span{display:block;height:100%;background:linear-gradient(90deg,#4da3ff,#ffd84d);width:0%}
#thumb video{width:240px;height:135px;object-fit:cover;border-radius:10px;border:1px solid var(--stroke)}
a{color:var(--accent)}
</style>
</head>
<body>
  <div class="container">
    <h1>관리자 동영상 업로드 <span class="badge">내 계정만 허용</span></h1>

    <div class="card">
      <div class="row">
        <button id="loginBtn">Google 로그인</button>
        <div id="who" style="color:var(--muted)">로그인 필요</div>
      </div>
    </div>

    <div class="card">
      <div class="row"><input id="title" placeholder="제목(선택)" style="flex:1;min-width:220px"/></div>
      <div class="row" style="margin-top:8px">
        <input id="file" type="file" accept="video/*"/>
        <button id="uploadBtn" disabled>업로드</button>
      </div>
      <div id="thumb" class="row" style="margin-top:8px"></div>
      <div class="progress" style="margin-top:8px"><span id="bar"></span></div>
      <div id="status" style="margin-top:8px;color:var(--muted)">대기 중</div>
    </div>

    <div class="card">
      <b>업로드된 영상 보기:</b> <a href="videos.html">videos.html</a>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>

  <script>
  // ① 여기를 네 프로젝트 값으로 교체
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    appId: "YOUR_APP_ID"
  };
  // ② 관리자 UID(너의 계정 UID)로 교체 (아래 콘솔 로그로 확인 가능)
  const ADMIN_UID = "YOUR_ADMIN_UID";

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const loginBtn = document.getElementById('loginBtn');
  const who = document.getElementById('who');
  const file = document.getElementById('file');
  const title = document.getElementById('title');
  const uploadBtn = document.getElementById('uploadBtn');
  const bar = document.getElementById('bar');
  const statusEl = document.getElementById('status');
  const thumb = document.getElementById('thumb');

  let currentUser = null;

  auth.onAuthStateChanged(async (u)=>{
    currentUser = u;
    if(u){
      who.textContent = `로그인됨: ${u.email} (uid: ${u.uid})`;
      console.log('내 UID 복사해 rules/ADMIN_UID에 넣으세요:', u.uid);
      uploadBtn.disabled = (u.uid !== ADMIN_UID);
      loginBtn.textContent = '로그아웃';
    }else{
      who.textContent = '로그인 필요';
      uploadBtn.disabled = true;
      loginBtn.textContent = 'Google 로그인';
    }
  });

  loginBtn.onclick = async ()=>{
    if(currentUser){ await auth.signOut(); return; }
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  };

  file.addEventListener('change', ()=>{
    thumb.innerHTML = '';
    const f = file.files[0];
    if(!f) return;
    const v = document.createElement('video');
    v.src = URL.createObjectURL(f); v.muted = true; v.playsInline = true; v.controls = true;
    thumb.appendChild(v);
  });

  uploadBtn.onclick = async ()=>{
    const f = file.files[0];
    if(!currentUser || currentUser.uid !== ADMIN_UID){ alert('관리자만 업로드할 수 있습니다.'); return; }
    if(!f){ alert('파일을 선택하세요'); return; }

    const path = `videos/${Date.now()}_${f.name}`;
    const ref = storage.ref().child(path);
    const task = ref.put(f);

    task.on('state_changed', (snap)=>{
      const pct = Math.round((snap.bytesTransferred/snap.totalBytes)*100);
      bar.style.width = pct + '%';
      statusEl.textContent = `업로드 중… ${pct}%`;
    }, (err)=>{
      statusEl.textContent = '에러: ' + err.message;
    }, async ()=>{
      const url = await ref.getDownloadURL();
      await db.collection('videos').add({
        title: title.value || f.name,
        url,
        path,
        size: f.size,
        type: f.type,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      statusEl.textContent = '업로드 완료';
      file.value = ''; title.value = ''; bar.style.width = '0%';
    });
  };
  </script>
</body>
</html>
